{% extends "base.html" %}
{% set title = "My Dashboard" %}

{% block content %}

<!-- Player header (keep your existing header block) -->

<!-- Exit Velocity Trend -->
<div class="card">
  <div class="card-title">Exit Velocity Trend</div>

  {% if dates and dates|length > 0 %}
    <div style="height:280px">
      <canvas id="evChart"></canvas>
    </div>
  {% else %}
    <div class="muted">No exit velocity data yet.</div>
  {% endif %}
</div>

<!-- Updated Metrics + Coach Notes / Assigned Drills row -->
<div class="grid grid-2">
  <div class="card">
    <div class="card-title">Updated Metrics</div>
    {% if latest_metrics and latest_metrics|length > 0 %}
      <ul class="list">
        {% for m in latest_metrics %}
          <li>
            <strong>{{ m.metric|replace('_',' ')|title }}</strong>:
            {{ m.value }}{% if m.unit %} {{ m.unit }}{% endif %}
            <span class="muted"> — {{ m.recorded_at|datetimeformat }}</span>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="muted">No metrics yet.</div>
    {% endif %}
  </div>

  <!-- Keep your existing Coach Notes / Assigned Drills cards.
       If you’d rather keep the current two-card layout, you can put
       “Updated Metrics” above them or as a third card. -->
</div>

{% endblock %}

{% block scripts %}
  {{ super() }}

  {% if dates and dates|length > 0 %}
  <script>
  (function () {
    const labels = {{ dates|tojson }};
    const dataEV = {{ exitv|tojson }};

    const canvas = document.getElementById('evChart');
    if (!canvas) return;
    if (typeof Chart === 'undefined') { console.warn('Chart.js not loaded'); return; }

    // Create the chart
    new Chart(canvas.getContext('2d'), {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Exit Velocity',
          data: dataEV,
          borderWidth: 2,
          tension: 0.3,
          fill: false
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: { y: { beginAtZero: true } }
      }
    });
  })();
  </script>
  {% endif %}
{% endblock %}
